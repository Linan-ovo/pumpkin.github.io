<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>并发操作下的订单状态更新策略优化与性能影响分析</title>
      <link href="/2024/11/17/%E6%98%AF%E6%88%91/"/>
      <url>/2024/11/17/%E6%98%AF%E6%88%91/</url>
      
        <content type="html"><![CDATA[<h2 id="问题描述">问题描述</h2><p>在观看黑马的苍穹外卖系列教程中的用户取消订单功能代码开发时，我们注意到作者首先通过查询获取了被用户取消的订单的所有属性，并存储在ordersDB变量中<br>然而，在修改数据库时，作者并未直接对ordersDB变量进行操作，而是创建了一个新的Orders类型的orders变量，仅包含需要修改的属性，然后进行了update操作<br>详细代码如下</p><div class="tabs" id=""><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#-1">Orders.java</button></li><li class="tab"><button type="button" data-href="#-2">OrderServiceImpl.java</button></li><li class="tab"><button type="button" data-href="#-3">OrderMapper.xml</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="-1"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Builder</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Orders</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 订单状态 1待付款 2待接单 3已接单 4派送中 5已完成 6已取消</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Integer</span> <span class="variable">PENDING_PAYMENT</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Integer</span> <span class="variable">TO_BE_CONFIRMED</span> <span class="operator">=</span> <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Integer</span> <span class="variable">CONFIRMED</span> <span class="operator">=</span> <span class="number">3</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Integer</span> <span class="variable">DELIVERY_IN_PROGRESS</span> <span class="operator">=</span> <span class="number">4</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Integer</span> <span class="variable">COMPLETED</span> <span class="operator">=</span> <span class="number">5</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Integer</span> <span class="variable">CANCELLED</span> <span class="operator">=</span> <span class="number">6</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 支付状态 0未支付 1已支付 2退款</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Integer</span> <span class="variable">UN_PAID</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Integer</span> <span class="variable">PAID</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Integer</span> <span class="variable">REFUND</span> <span class="operator">=</span> <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//订单号</span></span><br><span class="line">    <span class="keyword">private</span> String number;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//订单状态 1待付款 2待接单 3已接单 4派送中 5已完成 6已取消 7退款</span></span><br><span class="line">    <span class="keyword">private</span> Integer status;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//下单用户id</span></span><br><span class="line">    <span class="keyword">private</span> Long userId;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//地址id</span></span><br><span class="line">    <span class="keyword">private</span> Long addressBookId;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//下单时间</span></span><br><span class="line">    <span class="keyword">private</span> LocalDateTime orderTime;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//结账时间</span></span><br><span class="line">    <span class="keyword">private</span> LocalDateTime checkoutTime;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//支付方式 1微信，2支付宝</span></span><br><span class="line">    <span class="keyword">private</span> Integer payMethod;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//支付状态 0未支付 1已支付 2退款</span></span><br><span class="line">    <span class="keyword">private</span> Integer payStatus;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//实收金额</span></span><br><span class="line">    <span class="keyword">private</span> BigDecimal amount;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//备注</span></span><br><span class="line">    <span class="keyword">private</span> String remark;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//用户名</span></span><br><span class="line">    <span class="keyword">private</span> String userName;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//手机号</span></span><br><span class="line">    <span class="keyword">private</span> String phone;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//地址</span></span><br><span class="line">    <span class="keyword">private</span> String address;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//收货人</span></span><br><span class="line">    <span class="keyword">private</span> String consignee;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//订单取消原因</span></span><br><span class="line">    <span class="keyword">private</span> String cancelReason;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//订单拒绝原因</span></span><br><span class="line">    <span class="keyword">private</span> String rejectionReason;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//订单取消时间</span></span><br><span class="line">    <span class="keyword">private</span> LocalDateTime cancelTime;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//预计送达时间</span></span><br><span class="line">    <span class="keyword">private</span> LocalDateTime estimatedDeliveryTime;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//配送状态  1立即送出  0选择具体时间</span></span><br><span class="line">    <span class="keyword">private</span> Integer deliveryStatus;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//送达时间</span></span><br><span class="line">    <span class="keyword">private</span> LocalDateTime deliveryTime;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//打包费</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> packAmount;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//餐具数量</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> tablewareNumber;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//餐具数量状态  1按餐量提供  0选择具体数量</span></span><br><span class="line">    <span class="keyword">private</span> Integer tablewareStatus;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="-2"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">userCancelById</span><span class="params">(Long id)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="comment">// 根据id查询订单</span></span><br><span class="line">    <span class="type">Orders</span> <span class="variable">ordersDB</span> <span class="operator">=</span> orderMapper.getById(id);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 校验订单是否存在</span></span><br><span class="line">    <span class="keyword">if</span> (ordersDB == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">OrderBusinessException</span>(MessageConstant.ORDER_NOT_FOUND);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//订单状态 1待付款 2待接单 3已接单 4派送中 5已完成 6已取消</span></span><br><span class="line">    <span class="keyword">if</span> (ordersDB.getStatus() &gt; <span class="number">2</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">OrderBusinessException</span>(MessageConstant.ORDER_STATUS_ERROR);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">Orders</span> <span class="variable">orders</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Orders</span>();</span><br><span class="line">    orders.setId(ordersDB.getId());</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 订单处于待接单状态下取消，需要进行退款</span></span><br><span class="line">    <span class="keyword">if</span> (ordersDB.getStatus().equals(Orders.TO_BE_CONFIRMED)) &#123;</span><br><span class="line">        <span class="comment">//调用微信支付退款接口</span></span><br><span class="line">        weChatPayUtil.refund(</span><br><span class="line">                ordersDB.getNumber(), <span class="comment">//商户订单号</span></span><br><span class="line">                ordersDB.getNumber(), <span class="comment">//商户退款单号</span></span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">BigDecimal</span>(<span class="number">0.01</span>),<span class="comment">//退款金额，单位 元</span></span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">BigDecimal</span>(<span class="number">0.01</span>));<span class="comment">//原订单金额</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//支付状态修改为 退款</span></span><br><span class="line">        orders.setPayStatus(Orders.REFUND);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 更新订单状态、取消原因、取消时间</span></span><br><span class="line">    orders.setStatus(Orders.CANCELLED);</span><br><span class="line">    orders.setCancelReason(<span class="string">&quot;用户取消&quot;</span>);</span><br><span class="line">    orders.setCancelTime(LocalDateTime.now());</span><br><span class="line">    orderMapper.update(orders);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="-3"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&lt;update id=<span class="string">&quot;update&quot;</span> parameterType=<span class="string">&quot;com.sky.entity.Orders&quot;</span>&gt;</span><br><span class="line">        update orders</span><br><span class="line">        &lt;set&gt;</span><br><span class="line">            &lt;<span class="keyword">if</span> test=<span class="string">&quot;cancelReason != null and cancelReason!=&#x27;&#x27; &quot;</span>&gt;</span><br><span class="line">                cancel_reason=#&#123;cancelReason&#125;,</span><br><span class="line">            &lt;/<span class="keyword">if</span>&gt;</span><br><span class="line">            &lt;<span class="keyword">if</span> test=<span class="string">&quot;rejectionReason != null and rejectionReason!=&#x27;&#x27; &quot;</span>&gt;</span><br><span class="line">                rejection_reason=#&#123;rejectionReason&#125;,</span><br><span class="line">            &lt;/<span class="keyword">if</span>&gt;</span><br><span class="line">            &lt;<span class="keyword">if</span> test=<span class="string">&quot;cancelTime != null&quot;</span>&gt;</span><br><span class="line">                cancel_time=#&#123;cancelTime&#125;,</span><br><span class="line">            &lt;/<span class="keyword">if</span>&gt;</span><br><span class="line">            &lt;<span class="keyword">if</span> test=<span class="string">&quot;payStatus != null&quot;</span>&gt;</span><br><span class="line">                pay_status=#&#123;payStatus&#125;,</span><br><span class="line">            &lt;/<span class="keyword">if</span>&gt;</span><br><span class="line">            &lt;<span class="keyword">if</span> test=<span class="string">&quot;payMethod != null&quot;</span>&gt;</span><br><span class="line">                pay_method=#&#123;payMethod&#125;,</span><br><span class="line">            &lt;/<span class="keyword">if</span>&gt;</span><br><span class="line">            &lt;<span class="keyword">if</span> test=<span class="string">&quot;checkoutTime != null&quot;</span>&gt;</span><br><span class="line">                checkout_time=#&#123;checkoutTime&#125;,</span><br><span class="line">            &lt;/<span class="keyword">if</span>&gt;</span><br><span class="line">            &lt;<span class="keyword">if</span> test=<span class="string">&quot;status != null&quot;</span>&gt;</span><br><span class="line">                status = #&#123;status&#125;,</span><br><span class="line">            &lt;/<span class="keyword">if</span>&gt;</span><br><span class="line">            &lt;<span class="keyword">if</span> test=<span class="string">&quot;deliveryTime != null&quot;</span>&gt;</span><br><span class="line">                delivery_time = #&#123;deliveryTime&#125;</span><br><span class="line">            &lt;/<span class="keyword">if</span>&gt;</span><br><span class="line">        &lt;/set&gt;</span><br><span class="line">        <span class="type">where</span> <span class="variable">id</span> <span class="operator">=</span> #&#123;id&#125;</span><br><span class="line">    &lt;/update&gt;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="原因分析">原因分析</h2><p>在Orders类中，属性众多，而update方法作为一个通用的数据库更新操作，可能涉及多个属性的修改<br>该方法在更新时，会根据传入的Orders对象中的属性值进行条件判断，若属性值非空则进行更新（有新数据就更新成最新数据，没有新数据就保持原样）<br>然而，在用户取消订单的场景中，实际需要修改的属性仅有三个：订单状态、取消原因和取消时间<br>所以有必要进行这么多次的判断和修改吗？<br>答案当然是没有<br>如果直接对ordersDB变量执行update操作，可能会引发以下两种问题</p><h3 id="并发操作下的更新覆盖问题">并发操作下的更新覆盖问题</h3><p>在并发环境下，多个用户可能同时对同一组数据进行操作<br>我们用一个例子来说明这个问题<br>用户A正在执行id修改update操作，希望将id由1修改为2<br>用户B执行了用户ID换绑操作，希望将userId由LN修改为LTC<br>由于数据库操作的原子性，这两个操作在数据库层面是串行执行的<br>然而，如果直接对ordersDB变量进行update，那么即使后一个操作（用户ID换绑）先完成，其更改也可能被前一个操作（更改id）中的update语句所覆盖</p><div class="tabs" id=""><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#-1">开始执行update</button></li><li class="tab"><button type="button" data-href="#-2">用户执行换绑操作</button></li><li class="tab"><button type="button" data-href="#-3">换绑执行结束</button></li><li class="tab"><button type="button" data-href="#-4">update执行结束</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="-1"><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">OrderDB:</span><br><span class="line">id: <span class="number">1</span></span><br><span class="line">number:<span class="number">3</span></span><br><span class="line">status:<span class="number">1</span><span class="operator">-</span><span class="operator">&gt;</span><span class="number">2</span> #修改状态为<span class="number">2</span></span><br><span class="line">userId: LN</span><br><span class="line">addressBookId: <span class="number">3</span></span><br><span class="line">orderTime:<span class="number">2024</span><span class="number">-11</span><span class="number">-15</span> <span class="number">13</span>:<span class="number">05</span>:<span class="number">06</span></span><br><span class="line">checkTime:<span class="number">2024</span><span class="number">-11</span><span class="number">-15</span> <span class="number">13</span>:<span class="number">05</span>:<span class="number">06</span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="-2"><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">OrderDB:</span><br><span class="line">id: <span class="number">1</span></span><br><span class="line">number:<span class="number">3</span></span><br><span class="line">status: <span class="number">1</span></span><br><span class="line">userId: LN <span class="operator">-</span><span class="operator">&gt;</span>LTC #修改userId</span><br><span class="line">addressBookId:<span class="number">3</span></span><br><span class="line">orderTime:<span class="number">2024</span><span class="number">-11</span><span class="number">-15</span> <span class="number">13</span>:<span class="number">05</span>:<span class="number">07</span></span><br><span class="line">checkTime:<span class="number">2024</span><span class="number">-11</span><span class="number">-15</span> <span class="number">13</span>:<span class="number">05</span>:<span class="number">07</span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="-3"><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">OrderDB:</span><br><span class="line">id: <span class="number">1</span></span><br><span class="line">number: <span class="number">3</span></span><br><span class="line">status: <span class="number">1</span></span><br><span class="line">userId: LTC</span><br><span class="line">addressBookId:<span class="number">3</span></span><br><span class="line">orderTime:<span class="number">2024</span><span class="number">-11</span><span class="number">-15</span> <span class="number">13</span>:<span class="number">05</span>:<span class="number">08</span></span><br><span class="line">checkTime:<span class="number">2024</span><span class="number">-11</span><span class="number">-15</span> <span class="number">13</span>:<span class="number">05</span>:<span class="number">08</span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="-4"><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">OrderDB:</span><br><span class="line">id: <span class="number">1</span></span><br><span class="line">number:<span class="number">3</span></span><br><span class="line">status:<span class="number">2</span></span><br><span class="line">userId: LN #重新以<span class="number">1</span>的userld覆盖了刚才的更改</span><br><span class="line">addressBookId:<span class="number">3</span></span><br><span class="line">orderTime:<span class="number">2024</span><span class="number">-11</span><span class="number">-15</span> <span class="number">13</span>:<span class="number">05</span>:<span class="number">06</span></span><br><span class="line">checkTime:<span class="number">2024</span><span class="number">-11</span><span class="number">-15</span> <span class="number">13</span>:<span class="number">05</span>:<span class="number">06</span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><p>为了避免这种并发操作下的更新覆盖问题，作者选择创建一个新的Orders对象orders，仅包含需要修改的属性，并对其进行update操作。这样，即使存在并发操作，也只会影响需要修改的属性，而不会覆盖其他属性的更改。</p><h3 id="增加的-Binlog-日志数量及性能影响">增加的 Binlog 日志数量及性能影响</h3><p>当选择直接修改现有的 ordersDB 数据库中的表结构或数据记录时<br>每次修改（无论是添加、删除还是更新数据）都会被记录在 MySQL 的二进制日志（binlog）中<br>这些日志对于数据恢复、复制和审计至关重要，然而，如果频繁地对大型表进行结构修改或大量数据更新，会导致 binlog 日志量显著增加</p><h2 id="总结">总结</h2><p>在进行数据库更新操作时，通过创建新的对象并仅修改需要更新的属性，可以有效地避免并发操作下的更新覆盖问题，并减少不必要的binlog日志生成，从而优化数据库性能和稳定性</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>helloworld.md</title>
      <link href="/2024/11/14/helloworld-md/"/>
      <url>/2024/11/14/helloworld-md/</url>
      
        <content type="html"><![CDATA[]]></content>
      
      
      
    </entry>
    
    
  
  
</search>
